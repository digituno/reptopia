{% extends 'base.html.j2' %}
{% load static %}

{% block content %}
<!-- Begin page content -->
<div class="container">
    <div class="page-header">
        <div class="pull-right">
            <div class="btn-group" role="group" aria-label="Basic example">
                {% if account.is_authenticated %}
                    <a href="{% url 'account-update' pk=account.pk %}">
                        <button type="button" class="btn btn-default">정보수정</button>
                    </a>
                {% endif %}
                <a href="{% url 'index' %}">
                    <button type="button" class="btn btn-default">돌아가기</button>
                </a>
            </div>
        </div>
        <h1>Account detail</h1>
    </div>
    <form id="account_profile_form" method="post" action="" class="form-horizontal" enctype="multipart/form-data">{% csrf_token %}
    <div class="row">
        <div class="col-sm-2">
            {% if account.image %}
            <img src="{{ account.image.url }}" class="img-circle" width="150" height="150"> </div>
            {% endif %}
        <div class="col-sm-10">
            <h5> {{ account.name}} ( {{ account.email }} ) </h5>
            <hr />
            <pre class="well">{{ account.bio }}</pre>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <li data-id="{{ account.pk }}" data-type="account" data-action="like" title="Like">
                <span class="glyphicon glyphicon-thumbs-up"></span>
                <span data-count="like">{{ account.likes.likes.count }}</span>
            </li>
            <li data-id="{{ account.pk }}" data-type="account" data-action="dislike" title="Dislike">
                <span class="glyphicon glyphicon-thumbs-down"></span>
                <span data-count="dislike">{{ account.likes.dislikes.count }}</span>
            </li>
        </div>
    <div>
    </form>
</div>
{% endblock %}

{% block script_content %}
<script>
    function like()
    {
        var like = $(this);
        var type = like.data('type');
        var pk = like.data('id');
        var action = like.data('action');
        var dislike = like.next();

        $.ajax({
            url : "/" + action + "/" + type + "/" + pk,
            //type : 'POST',
            data : { 'obj' : pk },

            success : function (json) {
                like.find("[data-count='like']").text(json.like_count);
                dislike.find("[data-count='dislike']").text(json.dislike_count);
            }
        });

        return false;
    }

    function dislike()
    {
        var dislike = $(this);
        var type = dislike.data('type');
        var pk = dislike.data('id');
        var action = dislike.data('action');
        var like = dislike.prev();

        $.ajax({
            url : "/" + action + "/" + type + "/" + pk,
            //type : 'POST',
            data : { 'obj' : pk },

            success : function (json) {
                dislike.find("[data-count='dislike']").text(json.dislike_count);
                like.find("[data-count='like']").text(json.like_count);
            }
        });

        return false;
    }

    // Connecting Handlers
    $(function() {
        $('[data-action="like"]').click(like);
        $('[data-action="dislike"]').click(dislike);
    });
</script>
{% endblock %}
