{% extends 'base.html.j2' %}
{% load static %}
{% load taggit_templatetags2_tags %}

{% block stylesheet %}
    <link rel="stylesheet" type="text/css" href="{% static 'lib/magnific-popup/css/magnific-popup.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'lib/magnific-popup/css/magnific-util.min.css' %}" />
    <style>
        #chartdiv {
            width: 100%;
            height: 300px;
            /*background-color: lightgrey;*/
        }
    </style>
    <script src="{% static 'lib/holder/holder.js' %}"></script>
{% endblock %}

{% block content %}
<!-- 주간 TOP 3 이미지-->
<div id="myCarousel" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
    <ol class="carousel-indicators">
        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
        <li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
    </ol>
    <div class="carousel-inner" role="listbox">
        <div class="item active">
            <img class="first-slide" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="First slide">
            <div class="container">
                <div class="carousel-caption">
                    <h1>Example headline.</h1>
                    <p>Note: If you're viewing this page via a <code>file://</code> URL, the "next" and "previous" Glyphicon buttons on the left and right might not load/display properly due to web browser security rules.</p>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Sign up today</a></p>
                </div>
            </div>
        </div>
        <div class="item">
            <img class="second-slide" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Second slide">
            <div class="container">
                <div class="carousel-caption">
                    <h1>Another example headline.</h1>
                    <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Learn more</a></p>
                </div>
            </div>
        </div>
        <div class="item">
            <img class="third-slide" src="data:image/gif;base64,R0lGODlhAQABAIAAAHd3dwAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==" alt="Third slide">
            <div class="container">
                <div class="carousel-caption">
                    <h1>One more for good measure.</h1>
                    <p>Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta gravida at eget metus. Nullam id dolor id nibh ultricies vehicula ut id elit.</p>
                    <p><a class="btn btn-lg btn-primary" href="#" role="button">Browse gallery</a></p>
                </div>
            </div>
        </div>
    </div>
    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>
</div>

<div class="container marketing">
    <div class="row">
        <div class="col-sm-4">
            <h2><i class="fa fa-angle-right"></i> 등록된 사육자</h2>
            <div style="text-align: center;">
                <img src="holder.js/200x200?text={{ account_count }}" class="img-circle"/>
            </div>
        </div>
        <div class="col-sm-4">
            <h2><i class="fa fa-angle-right"></i> 등록된 개체</h2>
            <div style="text-align: center;">
                <img src="holder.js/200x200?text={{ pet_count }}" class="img-circle"/>
            </div>
        </div>
        <div class="col-sm-4">
            <h2><i class="fa fa-angle-right"></i> 등록된 사육일지</h2>
            <div style="text-align: center;">
                <img src="holder.js/200x200?text={{ care_count }}" class="img-circle"/>
            </div>
        </div>
    </div>
    <hr class="featurette-divider">
    <div class="row featurette">
        <div class="col-md-7">
        <h2 class="featurette-heading">REPTOPIA<span class="text-muted"> 태그 구름</span></h2>
        <p class="lead">REPTOPIA 에서 가장 많이 사용된 태그를 보여줍니다. 태그를 클릭하면 해당 태그가 포함 된 게시물을 찾아줍니다.</p>
        </div>
        <div class="col-md-5">
            <div id="chartdiv"></div>
        </div>
    </div>
<div>

<div class="modal fade" tabindex="-1" role="dialog" id="notice_modal">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">{{ notice.title }}</h4> {{ notice.pub_date}} by {{ notice.author.name}}.
            </div>
            <div class="modal-body">
                <p>{{ notice.content | safe }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-warning" id="do_not_open">그만열기</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script_content %}
<script src="{% static 'lib/magnific-popup/jquery.magnific-popup.js' %}"></script>
<script src="{% static 'js/cookie_util.js' %}"></script>
<script src="{% static 'lib/amcharts/core.js' %}"></script>
<script src="{% static 'lib/amcharts/charts.js' %}"></script>
<script src="{% static 'lib/amcharts/plugins/wordCloud.js' %}"></script>
<script src="{% static 'lib/amcharts/themes/animated.js' %}"></script>

<script>
    $(document).ready(function() {
        // 저장된 쿠키값을 가져와서 ID 칸에 넣어준다. 없으면 공백으로 들어감.
        {% if notice %}
        var key = getCookie("notice_cookie" + {{ notice.pk }}) ;

        $("#do_not_open").click(function(){ // 체크박스에 변화가 있다면,
            setCookie("notice_cookie" + {{ notice.pk }}, 'do_not_open', 7);
            $('#notice_modal').modal('toggle')
        });

        if (key != 'do_not_open') {
            $('#notice_modal').modal('toggle')
        }
        {% endif %}
    });

    am4core.ready(function() {
        // Themes begin
        am4core.useTheme(am4themes_animated);
        // Themes end

        var chart = am4core.create("chartdiv", am4plugins_wordCloud.WordCloud);
        chart.fontFamily = "Courier New";
        var series = chart.series.push(new am4plugins_wordCloud.WordCloudSeries());
        series.randomness = 0.1;
        series.rotationThreshold = 0.5;

        {% get_tagcloud as tags %}
        series.data = [
            {% for tag in tags %}
                {"tag":"{{ tag.name }}"
                , "count":"{{ tag.num_times }}"
                , "id": "{{ tag.id }}"},
            {% endfor %}
        ];
        series.dataFields.word = "tag";
        series.dataFields.value = "count";

        series.heatRules.push({
            "target": series.labels.template,
            "property": "fill",
            "min": am4core.color("#0000CC"),
            "max": am4core.color("#CC00CC"),
            "dataField": "value"
        });
        series.labels.template.url = "http://127.0.0.1:8000/tags/tag-list/{id}/{word}";
        series.labels.template.urlTarget = "_self";
        series.labels.template.tooltipText = "{word}: {value}";

        var hoverState = series.labels.template.states.create("hover");
        hoverState.properties.fill = am4core.color("#FF0000");

        /*
        var subtitle = chart.titles.create();
        subtitle.text = "(click to open)";

        var title = chart.titles.create();
        title.text = "Reptopia 에서 가장 인기 있는 태그";
        title.fontSize = 20;
        title.fontWeight = "800";
        */
    });
</script>
{% endblock %}
